@model TemplateContext<Paragraph>

@{
    Paragraph contextObject = Model.Object;
    
    var parentTextFrame = Model.Local.Get<TextFrame>("parent");
    var tableContentFlag = Model.Local.Get<bool>("tableContent");
    var parentContainerSize = Model.Local.Get<SizeF>("parentContainerSize");
    bool isFirst = Model.Local.Get<bool>("isFirst");
    bool isLast = Model.Local.Get<bool>("isLast");
    
    var paragraphFormatEffective = contextObject.ParagraphFormat.GetEffective();
    
    double[] margins = TextHelper.GetParagraphMargins(paragraphFormatEffective, parentTextFrame, parentContainerSize, Model);
    var marginStyle = "margin-left: " + (int)margins[0] + "px; margin-top: " + (int)margins[1] + "px; margin-right: " + (int)margins[2] + "px; margin-bottom: " + (int)margins[3] + "px; ";
    var paddingStyle = 
        (isFirst ? "" : "padding-top: " + (int)margins[4] + "px; ") 
        + 
        (isLast ? "" : "padding-bottom: " + (int)margins[5] + "px; ");
    var paragraphStyle = marginStyle + paddingStyle + GetTextStyle(contextObject);
}

@functions
{
    string GetTextStyle(Paragraph paragraph)
    {
        return TextHelper.GetTextStyle(paragraph.ParagraphFormat.GetEffective(), Model);
    }
}

<p style="@paragraphStyle">
    @if (paragraphFormatEffective.Bullet.Type != BulletType.None)
    {
        @Raw(Include("bullet", Model).ToString().Replace(Environment.NewLine, ""))
    }
    @foreach (Portion portion in contextObject.Portions) 
    { 
        var subModel = Model.SubModel(portion);
        subModel.Local.Put("parentTextFrame", parentTextFrame);
        subModel.Local.Put("tableContent", tableContentFlag);
        @Raw(Include("portion", subModel).ToString().Replace(Environment.NewLine, ""));
    }
</p>